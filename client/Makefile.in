SOURCES=network.c error.c 3dsread.c proto_out.c proto_in.c event.c freetype.c io.c callback.c fontselect.c object_queue.c tcp.c shm.c shm_ringbuf.c tesselate.c
LIB_STATIC=libs3d.a
LIB_SHARED=libs3d.so
OBJS=$(SOURCES:.c=.o)

CC=@CC@
LD=@CC@
LIBS=@CLIENT_LIBS@

INSTALL_PROGRAM= /usr/bin/install -c -s -m 755
INSTALL_DIR= /usr/bin/install -c -d -m 755
INSTALL_DATA= /usr/bin/install -c -m 644
PREFIX=@PREFIX@
CFLAGS=@CFLAGS@ @DEFS@ @FTCFLAGS@ -Wall -ansi -pedantic @DEVEL_CFLAGS@ -fPIC -I../server/

LDFLAGS=@LDFLAGS@ @DEVEL_LDFLAGS@

all:	$(LIB_STATIC) $(LIB_SHARED) 
$(LIB_STATIC):	$(OBJS)
	ar rc $@ $(OBJS)
	ranlib $@
$(LIB_SHARED): $(OBJS)
	gcc $(OBJS) $(LDFLAGS) $(LIBS) -fPIC -shared -o $@
freetype.o: freetype.c s3d.h s3dlib.h
	 $(CC) $(CFLAGS) $(FT) -c $< -o $@
fontselect.o: fontselect.c s3d.h s3dlib.h
	 $(CC) $(CFLAGS) $(FT) -c $< -o $@
.c.o: s3d.h s3dlib.h
	 $(CC) $(CFLAGS) -c $< -o $@
install:
	$(INSTALL_DIR) $(PREFIX)/include/s3d
	$(INSTALL_DATA) s3d.h $(PREFIX)/include/s3d/
	ln -fs $(PREFIX)/include/s3d/s3d.h $(PREFIX)/include/s3d.h 
	$(INSTALL_DATA) libs3d.so $(PREFIX)/lib
	$(INSTALL_DATA) libs3d.a $(PREFIX)/lib
	ldconfig
uninstall:
	rm -f $(PREFIX)/include/s3d/s3d.h
	rm -f $(PREFIX)/lib/libs3d.so
	rm -f $(PREFIX)/lib/libs3d.a
	ldconfig
clean:
	rm -rf $(OBJS) $(LIB_STATIC) $(LIB_SHARED)
depend:
	makedepend $(CFLAGS) $(SOURCES)
